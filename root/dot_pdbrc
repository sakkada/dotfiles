# https://docs.python.org/3/library/pdb.html#debugger-commands
# Rc file may be located in ~/.pdbrc or ./.pdbrc.

# shortcut for alias
alias al alias

# pd: print a dictionary, sorted by keys, %1 is dict, %2 is name prefix
# po, ps, pl, pg: print internal __dict__, self, locals and globals respectively
alias pd !for s, k, m in sorted(zip( map(str,%1.keys()), %1.keys(), [max(map(len,map(str,%1.keys())))]*len(%1) )): print(f"%2{s.ljust(m)} = {%1[k]}")
alias po pd %1.__dict__ %1:
alias ps po self
alias pl pd locals() local:
alias pg pd globals() global:

# rich lib aliases, required rich
alias rp  !import rich; rich.print(%*)
alias rps rp self
alias rpl rp locals()
alias rpg rp globals()

# combine next and step with list commands
alias nn n;;l
alias ss s;;l

# asyncio support in pdb/ipdb, required nest-asyncio
# ap: (Asyncio Patch) - patch asyncio with nest_asyncio to allow run coroutines
# aw: (AWait)         - run coroutine (%*) and print result
# av: (Await Value)   - run coroutine (%* except %1) and save result in %1 var
alias ap !import nest_asyncio, asyncio; nest_asyncio.apply(); print('Ok, run "aw f()" or "av var f()"')
alias aw !asyncio.run(%*)
alias av !%1 = eval('asyncio.run(' + ' '.join('''%*'''.split()[1:]) + ')')
